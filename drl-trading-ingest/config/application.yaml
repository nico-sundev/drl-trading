# =============================================================================
# DRL Trading Data Ingestion Service - Base Configuration
# =============================================================================
# Base configuration that is common across all environments
# Stage-specific overrides are in application-{STAGE}.yaml files

# =============================================================================
# APPLICATION CONFIGURATION (maps to BaseApplicationConfig)
# =============================================================================
app_name: "drl-trading-ingest"

# =============================================================================
# INFRASTRUCTURE CONFIGURATION (maps to InfrastructureConfig)
# =============================================================================
infrastructure:
  messaging:
    provider: "in_memory"  # Default for development/training
    host: null
    port: null
    username: null
    password: null
    vhost: null

  database:
    provider: "postgresql"
    host: "localhost"
    port: 5432
    database: "drl_trading"
    username: "trading_user"
    password: "${DB_PASSWORD:secure_password}"  # Secret substitution

  webapi:
    port: 8080
    host: "0.0.0.0"
    debug: false
    threaded: true
    max_content_length: 16777216  # 16MB

  monitoring:
    prometheus_enabled: false
    prometheus_port: 9090
    jaeger_enabled: false
    jaeger_endpoint: null

# =============================================================================
# DATA SOURCE CONFIGURATION (maps to DataSourceConfig)
# =============================================================================
data_source:
  default_provider: "csv"
  enable_multiple_providers: false

  # CSV File Provider (Local files)
  csv:
    enabled: true
    base_path: "drl-trading-core/data/csv"
    symbols: ["EURUSD", "GBPUSD", "USDJPY"]
    file_pattern: "{symbol}_{timeframe}.csv"

  # Binance Cryptocurrency Exchange
  binance:
    enabled: false
    api_key_env: "BINANCE_API_KEY"
    secret_key_env: "BINANCE_SECRET_KEY"
    base_url: "https://api.binance.com"
    testnet: false
    symbols: ["BTCUSDT", "ETHUSDT"]
    timeframes: ["1h", "1d"]
    max_bars: 1000
    websocket_url: "wss://stream.binance.com:9443"
    reconnect_attempts: 5
    ping_interval: 30

  # Twelve Data (Stocks, Forex, Crypto)
  twelve_data:
    enabled: false
    api_key_env: "TWELVE_DATA_API_KEY"
    base_url: "https://api.twelvedata.com"
    symbols: ["AAPL", "SPY"]
    intervals: ["1h", "1day"]
    outputsize: 5000
    data_types: ["stocks"]
    websocket_url: "wss://ws.twelvedata.com/v1"
    price_stream: true
    quote_stream: false

  # Yahoo Finance (Stocks, ETFs, Indices)
  yahoo:
    enabled: false
    symbols: ["SPY", "QQQ"]
    intervals: ["1h", "1d"]
    max_period: "1y"

# =============================================================================
# MESSAGE ROUTING CONFIGURATION (maps to MessageRoutingConfig)
# =============================================================================
message_routing:
  market_data_topic: "market_data"
  heartbeat_topic: "heartbeat"
  error_topic: "ingest_errors"

  heartbeat_interval: 30  # seconds
  batch_size: 100
  max_retry_attempts: 3
  retry_delay: 5  # seconds

# =============================================================================
# DATA VALIDATION CONFIGURATION (maps to DataValidationConfig)
# =============================================================================
data_validation:
  enable_validation: true
  max_price_deviation: 0.1  # 10% max price change
  min_volume_threshold: 0
  max_age_seconds: 300  # 5 minutes max age

  # Outlier detection
  enable_outlier_detection: true
  outlier_threshold: 3.0  # standard deviations
