import pandas as pd
import pytest

from drl_trading_framework.common.model.asset_price_dataset import AssetPriceDataSet


@pytest.fixture
def mock_ohlcv_data_1h(base_dataset=True):
    """Fixture to provide mock OHLCV data wrapped in AssetPriceDataSet."""
    dates = pd.to_datetime(
        [
            "2008-10-03 13:00:00",
            "2008-10-03 14:00:00",
            "2008-10-03 15:00:00",
            "2008-10-03 16:00:00",
            "2008-10-03 17:00:00",
            "2008-10-03 18:00:00",
            "2008-10-03 19:00:00",
            "2008-10-03 20:00:00",
            "2008-10-03 21:00:00",
            "2008-10-03 22:00:00",
            "2008-10-03 23:00:00",
            "2008-10-04 00:00:00",
            "2008-10-04 01:00:00",
            "2008-10-04 02:00:00",
            "2008-10-04 03:00:00",
            "2008-10-04 04:00:00",
            "2008-10-04 05:00:00",
            "2008-10-04 06:00:00",
            "2008-10-04 07:00:00",
            "2008-10-04 08:00:00",
            "2008-10-04 09:00:00",
            "2008-10-04 10:00:00",
            "2008-10-04 11:00:00",
            "2008-10-04 12:00:00",
            "2008-10-04 13:00:00",
            "2008-10-04 14:00:00",
            "2008-10-04 15:00:00",
            "2008-10-04 16:00:00",
            "2008-10-04 17:00:00",
            "2008-10-04 18:00:00",
        ]
    )
    data = {
        "Open": [
            1.37475,
            1.3748,
            1.3809,
            1.3816,
            1.38,
            1.38585,
            1.3900,
            1.3925,
            1.3950,
            1.3975,
            1.4000,
            1.4025,
            1.4050,
            1.4075,
            1.4100,
            1.4125,
            1.4150,
            1.4175,
            1.4200,
            1.4225,
            1.4250,
            1.4275,
            1.4300,
            1.4325,
            1.4350,
            1.4375,
            1.4400,
            1.4425,
            1.4450,
            1.4475,
        ],
        "High": [
            1.3767,
            1.38285,
            1.38415,
            1.3863,
            1.3871,
            1.3900,
            1.3950,
            1.3975,
            1.4000,
            1.4025,
            1.4050,
            1.4075,
            1.4100,
            1.4125,
            1.4150,
            1.4175,
            1.4200,
            1.4225,
            1.4250,
            1.4275,
            1.4300,
            1.4325,
            1.4350,
            1.4375,
            1.4400,
            1.4425,
            1.4450,
            1.4475,
            1.4500,
            1.4525,
        ],
        "Low": [
            1.37025,
            1.37175,
            1.3783,
            1.37895,
            1.3789,
            1.3830,
            1.3880,
            1.3905,
            1.3930,
            1.3955,
            1.3980,
            1.4005,
            1.4030,
            1.4055,
            1.4080,
            1.4105,
            1.4130,
            1.4155,
            1.4180,
            1.4205,
            1.4230,
            1.4255,
            1.4280,
            1.4305,
            1.4330,
            1.4355,
            1.4380,
            1.4405,
            1.4430,
            1.4455,
        ],
        "Close": [
            1.3748,
            1.3809,
            1.38155,
            1.37995,
            1.38585,
            1.3900,
            1.3925,
            1.3950,
            1.3975,
            1.4000,
            1.4025,
            1.4050,
            1.4075,
            1.4100,
            1.4125,
            1.4150,
            1.4175,
            1.4200,
            1.4225,
            1.4250,
            1.4275,
            1.4300,
            1.4325,
            1.4350,
            1.4375,
            1.4400,
            1.4425,
            1.4450,
            1.4475,
            1.4500,
        ],
        "Volume": [
            73566,
            58872,
            52659,
            37992,
            47956,
            50000,
            52000,
            54000,
            56000,
            58000,
            60000,
            62000,
            64000,
            66000,
            68000,
            70000,
            72000,
            74000,
            76000,
            78000,
            80000,
            82000,
            84000,
            86000,
            88000,
            90000,
            92000,
            94000,
            96000,
            98000,
        ],
    }
    df = pd.DataFrame(data, dates)

    return AssetPriceDataSet("H1", base_dataset, asset_price_dataset=df)

@pytest.fixture
def mock_ohlcv_data_4h(base_dataset=True):
    """Fixture to provide mock OHLCV data for 4H timeframe wrapped in AssetPriceDataSet."""
    dates = pd.to_datetime(
        [
            "2008-10-03 00:00:00",
            "2008-10-03 04:00:00",
            "2008-10-03 08:00:00",
            "2008-10-03 12:00:00",
            "2008-10-03 16:00:00",
            "2008-10-03 20:00:00",
            "2008-10-04 00:00:00",
            "2008-10-04 04:00:00",
            "2008-10-04 08:00:00",
            "2008-10-04 12:00:00",
            "2008-10-04 16:00:00",
            "2008-10-04 20:00:00",
            "2008-10-05 00:00:00",
            "2008-10-05 04:00:00",
            "2008-10-05 08:00:00",
            "2008-10-05 12:00:00",
            "2008-10-05 16:00:00",
            "2008-10-05 20:00:00",
            "2008-10-06 00:00:00",
            "2008-10-06 04:00:00",
            "2008-10-06 08:00:00",
            "2008-10-06 12:00:00",
            "2008-10-06 16:00:00",
            "2008-10-06 20:00:00",
            "2008-10-07 00:00:00",
            "2008-10-07 04:00:00",
            "2008-10-07 08:00:00",
            "2008-10-07 12:00:00",
            "2008-10-07 16:00:00",
            "2008-10-07 20:00:00",
        ]
    )

    data = {
        "Open": [
            1.3700,
            1.3740,
            1.3780,
            1.3820,
            1.3860,
            1.3900,
            1.3940,
            1.3980,
            1.4020,
            1.4060,
            1.4100,
            1.4140,
            1.4180,
            1.4220,
            1.4260,
            1.4300,
            1.4340,
            1.4380,
            1.4420,
            1.4460,
            1.4500,
            1.4540,
            1.4580,
            1.4620,
            1.4660,
            1.4700,
            1.4740,
            1.4780,
            1.4820,
            1.4860,
        ],
        "High": [
            1.3750,
            1.3790,
            1.3830,
            1.3870,
            1.3910,
            1.3950,
            1.3990,
            1.4030,
            1.4070,
            1.4110,
            1.4150,
            1.4190,
            1.4230,
            1.4270,
            1.4310,
            1.4350,
            1.4390,
            1.4430,
            1.4470,
            1.4510,
            1.4550,
            1.4590,
            1.4630,
            1.4670,
            1.4710,
            1.4750,
            1.4790,
            1.4830,
            1.4870,
            1.4910,
        ],
        "Low": [
            1.3650,
            1.3690,
            1.3730,
            1.3770,
            1.3810,
            1.3850,
            1.3890,
            1.3930,
            1.3970,
            1.4010,
            1.4050,
            1.4090,
            1.4130,
            1.4170,
            1.4210,
            1.4250,
            1.4290,
            1.4330,
            1.4370,
            1.4410,
            1.4450,
            1.4490,
            1.4530,
            1.4570,
            1.4610,
            1.4650,
            1.4690,
            1.4730,
            1.4770,
            1.4810,
        ],
        "Close": [
            1.3740,
            1.3780,
            1.3820,
            1.3860,
            1.3900,
            1.3940,
            1.3980,
            1.4020,
            1.4060,
            1.4100,
            1.4140,
            1.4180,
            1.4220,
            1.4260,
            1.4300,
            1.4340,
            1.4380,
            1.4420,
            1.4460,
            1.4500,
            1.4540,
            1.4580,
            1.4620,
            1.4660,
            1.4700,
            1.4740,
            1.4780,
            1.4820,
            1.4860,
            1.4900,
        ],
        "Volume": [
            100000,
            95000,
            90000,
            85000,
            80000,
            75000,
            70000,
            65000,
            60000,
            55000,
            50000,
            45000,
            40000,
            35000,
            30000,
            25000,
            20000,
            15000,
            10000,
            5000,
            1000,
            2000,
            3000,
            4000,
            5000,
            6000,
            7000,
            8000,
            9000,
            10000,
        ],
    }
    df = pd.DataFrame(data, dates)

    return AssetPriceDataSet("H4", base_dataset, asset_price_dataset=df)
