app_name: "drl-trading-preprocess"
version: "1.0.0"
stage: "local"

infrastructure:

  database:
    provider: "postgresql"
    host: "${DB_HOST}"
    port: ${DB_PORT}
    database: "${DB_NAME}"
    username: "${DB_USER}"
    password: "${DB_PASSWORD}"

  webapi:
    port: 8082
    host: "0.0.0.0"
    debug: true

  kafka:
    bootstrap_servers: "${KAFKA_BOOTSTRAP_SERVERS}"
    security_protocol: "PLAINTEXT"
    consumer_auto_offset_reset: "earliest"
    consumer_enable_auto_commit: false
    consumer_session_timeout_ms: 30000
    consumer_max_poll_interval_ms: 600000
    producer_acks: "all"
    producer_retries: 3
    producer_compression_type: "snappy"

  resilience:
    retry_configs:
      kafka_resampled_data_retry:
        max_attempts: 5
        wait_exponential_multiplier: 1.0
        wait_exponential_max: 60.0
        wait_jitter_max: 2.0
        stop_after_delay: null
      kafka_preprocessing_completed_retry:
        max_attempts: 3
        wait_exponential_multiplier: 2.0
        wait_exponential_max: 120.0
        wait_jitter_max: 5.0
        stop_after_delay: null
      kafka_dlq_retry:
        max_attempts: 1
        wait_exponential_multiplier: 1.0
        wait_exponential_max: 1.0
        wait_jitter_max: 0.0
        stop_after_delay: null

    consumer_failure_policies:
      critical_data_policy:
        max_retries: 3
        retry_topic: "retry.preprocess-data"
        dlq_topic: "dlq.preprocess-data"
        track_retry_in_headers: true
        retry_backoff_multiplier: 2.0
        retry_backoff_base_seconds: 1.0

kafka_consumers:
  consumer_group_id: "preprocess-service-group"
  topic_subscriptions:
    - topic: "requested.preprocess-data"
      handler_id: "preprocessing_request_handler"
      failure_policy_key: "critical_data_policy"
    - topic: "retry.preprocess-data"
      handler_id: "preprocessing_request_handler"
      failure_policy_key: "critical_data_policy"

kafka_topics:
  resampled_data:
    topic: "requested.store-resampled-data"
    retry_config_key: "kafka_resampled_data_retry"
  preprocessing_completed:
    topic: "completed.preprocess-data"
    retry_config_key: "kafka_preprocessing_completed_retry"
  preprocessing_error:
    topic: "error.preprocess-data"
    retry_config_key: "kafka_dlq_retry"


feature_store_config:
  cache_enabled: true
  ttl_days: 1
  online_enabled: false
  config_directory: "config/local"
  offline_repo_strategy: "local"
  local_repo_config:
    repo_path: "data/feature_store"

logging:
  level: "DEBUG"
  json_format: false
  file_logging: true
  file_path: "logs/drl-trading-preprocess.log"
  console_enabled: true
  max_file_size: 10485760
  backup_count: 5

feature_computation_config:
  warmup_candles: 50  # Reduced for local testing with limited data

resample_config:
  max_batch_size: 50000
  progress_log_interval: 5000
  chunk_size: 25000
  memory_warning_threshold_mb: 500
  pagination_limit: 5000
  max_memory_usage_mb: 256
  state_backup_interval: 500
